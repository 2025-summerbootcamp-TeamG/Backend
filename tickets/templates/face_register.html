<!DOCTYPE html>
<html>
<head>
    <title>ì–¼êµ´ ë“±ë¡ ì‹œìŠ¤í…œ</title>
    <style>
        body { font-family: 'Segoe UI', Arial, sans-serif; margin: 0; background: #f4f6fa; }
        .container { max-width: 420px; min-width: 0; width: 100%; box-sizing: border-box; margin: 32px auto; background: #fff; border-radius: 14px; box-shadow: 0 2px 12px rgba(0,0,0,0.07); padding: 22px 24px 18px 24px; }
        h1 { text-align: center; margin-bottom: 24px; font-size: 1.5em; color: #222; letter-spacing: 1px; }
        .section { margin-bottom: 28px; }
        @media (max-width: 600px) {
            .container { max-width: 98vw; padding: 12px 2vw 10px 2vw; }
            h1 { font-size: 1.15em; }
            .section-title { font-size: 1em; }
        }
        .section-title { display: flex; align-items: center; font-size: 1.08em; font-weight: 600; color: #2d3a4a; margin-bottom: 10px; gap: 7px; }
        .section-title .icon { font-size: 1.15em; }
        .camera { text-align: center; margin-bottom: 10px; }
        #video { width: 100%; max-width: 320px; min-width: 180px; border-radius: 8px; border: 1.5px solid #e0e0e0; }
        .btn { padding: 8px 0.9em; min-width: 80px; background: #1976d2; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 1em; transition: background 0.15s; }
        .btn:hover { background: #1256a3; }
        .input-row { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 8px; }
        .input-row > * { flex: 1 1 120px; min-width: 0; }
        input[type="text"], input[type="number"], input[type="password"] {
            padding: 8px; border: 1px solid #cfd8dc; border-radius: 4px; width: 100%; font-size: 1em; background: #f8fafc;
            min-width: 0; box-sizing: border-box;
        }
        @media (max-width: 480px) {
            .input-row { flex-direction: column; gap: 6px; }
            .btn { width: 100%; min-width: 0; }
        }
        .result { margin: 16px 0 0 0; padding: 10px; border-radius: 5px; font-size: 0.97em; }
        .success { background: #e3f6e8; color: #256029; }
        .error { background: #ffeaea; color: #b71c1c; }
        ul#face-list { padding-left: 18px; margin-top: 8px; }
        ul#face-list li { margin-bottom: 6px; font-size: 0.96em; }
        .token-box { background: #f1f1f1; padding: 7px; border-radius: 4px; word-break: break-all; margin-top: 6px; }
        .sub-label { font-size: 0.96em; color: #6a7a8c; margin-bottom: 4px; display: block; }
        .center { text-align: center; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ì–¼êµ´ ë“±ë¡ ì‹œìŠ¤í…œ</h1>

        <!-- ë¡œê·¸ì¸ ì„¹ì…˜ -->
        <div class="section">
            <div class="section-title"><span class="icon">ğŸ”‘</span>ë¡œê·¸ì¸</div>
            <div class="input-row">
                <input type="text" id="login_email" placeholder="ì´ë©”ì¼" />
                <input type="password" id="login_password" placeholder="ë¹„ë°€ë²ˆí˜¸" />
            </div>
            <div class="input-row">
                <button class="btn" onclick="login()">ë¡œê·¸ì¸</button>
            </div>
            <div id="login_result"></div>
            <div id="token_box" class="token-box" style="display:none;"></div>
        </div>

        <!-- ì¹´ë©”ë¼ ì˜ì—­ -->
        <div class="section">
            <div class="section-title"><span class="icon">ğŸ“·</span>ì¹´ë©”ë¼</div>
            <div class="camera" style="position:relative; width:320px; height:240px; margin:0 auto;">
                <video id="video" autoplay style="width:100%; height:100%; border-radius:10px; z-index:1; background:#000;"></video>
                <canvas id="canvas" style="display:none"></canvas>
                <div id="face-guide" style="position:absolute; left:0; top:0; width:100%; height:100%; pointer-events:none; z-index:2;">
                    <svg width="100%" height="100%">
                        <ellipse cx="50%" cy="50%" rx="28%" ry="46%" style="fill:none;stroke:#e74c3c;stroke-width:3;stroke-dasharray:7 5"/>
                    </svg>
                </div>
                <div style="position:absolute; left:50%; bottom:12px; transform:translateX(-50%); background:#fff; border-radius:18px; padding:6px 18px; font-size:0.98em; color:#222; box-shadow:0 2px 8px #0001; z-index:3;">
                    ì¹´ë©”ë¼ë¥¼ ì •ë©´ìœ¼ë¡œ ë°”ë¼ë´ ì£¼ì„¸ìš”
                </div>
            </div>
            <div class="center">
                <button class="btn" onclick="startCamera()">ì¹´ë©”ë¼ ì‹œì‘</button>
            </div>
        </div>

        <!-- DB ê¸°ë°˜ ì–¼êµ´ ë“±ë¡/ìƒíƒœì¡°íšŒ í…ŒìŠ¤íŠ¸ ì˜ì—­ -->
        <div class="section">
            <div class="section-title"><span class="icon">ğŸ—„ï¸</span>DB ê¸°ë°˜ ì–¼êµ´ ë“±ë¡/ìƒíƒœì¡°íšŒ</div>
            <div class="input-row">
                <input type="text" id="db_token" placeholder="Access Token ì…ë ¥" />
                <input type="number" id="db_ticket_id" placeholder="í‹°ì¼“ ID" />
            </div>
            <div class="input-row">
                <select id="db_face_verified">
                    <option value="true">ë“±ë¡ë¨ (true)</option>
                    <option value="false">ë¯¸ë“±ë¡ (false)</option>
                </select>
                <button class="btn" type="button" onclick="dbRegisterFace()">DB ì–¼êµ´ ë“±ë¡(PATCH)</button>
                <button class="btn" type="button" onclick="dbGetFaceStatus()">DB ì–¼êµ´ ìƒíƒœì¡°íšŒ(GET)</button>
            </div>
            <div id="db_result"></div>
        </div>

        <!-- AWS Rekognition ë“±ë¡/ì¸ì¦ í…ŒìŠ¤íŠ¸ ì˜ì—­ -->
        <div class="section">
            <div class="section-title"><span class="icon">â˜ï¸</span>AWS Rekognition ë“±ë¡/ì¸ì¦</div>
            <div class="input-row">
                <input type="text" id="aws_token" placeholder="Access Token ì…ë ¥" />
                <input type="number" id="aws_ticket_id" placeholder="í‹°ì¼“ ID" />
            </div>
            <div class="input-row">
                <button class="btn" type="button" onclick="awsRegisterFace()">AWS ì–¼êµ´ ë“±ë¡(POST)</button>
                <button class="btn" type="button" onclick="awsAuthFace()">AWS ì–¼êµ´ ì¸ì¦(POST)</button>
            </div>
            <div id="aws_result"></div>
        </div>

        <!-- AWS Rekognition ì–¼êµ´ ëª©ë¡/ì‚­ì œ í…ŒìŠ¤íŠ¸ ì˜ì—­ -->
        <div class="section">
            <div class="section-title"><span class="icon">ğŸ“„</span>AWS ë“±ë¡ ì–¼êµ´ ëª©ë¡/ì‚­ì œ</div>
            <div class="input-row">
                <input type="text" id="aws_list_token" placeholder="Access Token ì…ë ¥" />
                <button class="btn" type="button" onclick="loadAwsFaceList()">ëª©ë¡ ìƒˆë¡œê³ ì¹¨</button>
            </div>
            <ul id="aws_face_list"></ul>
            <div id="aws_list_result"></div>
        </div>

        <!-- ê²°ê³¼ ë©”ì‹œì§€ ì˜ì—­ -->
        <div id="result"></div>
    </div>

    <script>
        let stream = null;
        let registeredFace = null;

        // ì¹´ë©”ë¼ ì‹œì‘
        async function startCamera() {
            try {
                stream = await navigator.mediaDevices.getUserMedia({ video: true });
                document.getElementById('video').srcObject = stream;
                showResult('ì¹´ë©”ë¼ê°€ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
            } catch (err) {
                showResult('ì¹´ë©”ë¼ ì ‘ê·¼ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.', 'error');
            }
        }

        // DB ê¸°ë°˜ ì–¼êµ´ ë“±ë¡ (PATCH)
        async function dbRegisterFace() {
            const token = document.getElementById('db_token').value;
            const ticketId = document.getElementById('db_ticket_id').value;
            const faceVerified = document.getElementById('db_face_verified').value;
            if (!token || !ticketId) {
                document.getElementById('db_result').innerHTML = '<div class="result error">í† í°ê³¼ í‹°ì¼“IDë¥¼ ì…ë ¥í•˜ì„¸ìš”.</div>';
                return;
            }
            try {
                const response = await fetch(`/api/v1/tickets/${ticketId}/register/`, {
                    method: 'PATCH',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + token
                    },
                    body: JSON.stringify({ face_verified: faceVerified === 'true' })
                });
                const text = await response.text();
                let result;
                try { result = JSON.parse(text); } catch (e) { result = text; }
                document.getElementById('db_result').innerHTML = '<pre>' + JSON.stringify(result, null, 2) + '</pre>';
            } catch (err) {
                document.getElementById('db_result').innerHTML = '<div class="result error">ì„œë²„ ì˜¤ë¥˜: ' + err.message + '</div>';
            }
        }
        // DB ê¸°ë°˜ ì–¼êµ´ ìƒíƒœì¡°íšŒ (GET)
        async function dbGetFaceStatus() {
            const token = document.getElementById('db_token').value;
            const ticketId = document.getElementById('db_ticket_id').value;
            if (!token || !ticketId) {
                document.getElementById('db_result').innerHTML = '<div class="result error">í† í°ê³¼ í‹°ì¼“IDë¥¼ ì…ë ¥í•˜ì„¸ìš”.</div>';
                return;
            }
            try {
                const response = await fetch(`/api/v1/tickets/${ticketId}/auth/`, {
                    method: 'GET',
                    headers: {
                        'Authorization': 'Bearer ' + token
                    }
                });
                const text = await response.text();
                let result;
                try { result = JSON.parse(text); } catch (e) { result = text; }
                document.getElementById('db_result').innerHTML = '<pre>' + JSON.stringify(result, null, 2) + '</pre>';
            } catch (err) {
                document.getElementById('db_result').innerHTML = '<div class="result error">ì„œë²„ ì˜¤ë¥˜: ' + err.message + '</div>';
            }
        }
        // AWS Rekognition ì–¼êµ´ ë“±ë¡ (POST)
        async function awsRegisterFace() {
            const token = document.getElementById('aws_token').value;
            const ticketId = document.getElementById('aws_ticket_id').value;
            if (!token || !ticketId) {
                document.getElementById('aws_result').innerHTML = '<div class="result error">í† í°ê³¼ í‹°ì¼“IDë¥¼ ì…ë ¥í•˜ì„¸ìš”.</div>';
                return;
            }
            // ê°€ì´ë“œë¼ì¸ ì²´í¬
            if (!(await checkFaceInEllipse())) {
                document.getElementById('aws_result').innerHTML = '<div class="result error">ì–¼êµ´ì„ ê°€ì´ë“œë¼ì¸ ì•ˆì— ë§ì¶°ì£¼ì„¸ìš”.</div>';
                return;
            }
            // ì¹´ë©”ë¼ ìº¡ì²˜
            const video = document.getElementById('video');
            const canvas = document.getElementById('canvas');
            const context = canvas.getContext('2d');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            context.drawImage(video, 0, 0);
            const imageData = canvas.toDataURL('image/jpeg').split(',')[1];
            try {
                const response = await fetch(`/api/v1/tickets/${ticketId}/aws-register/`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + token
                    },
                    body: JSON.stringify({ image: imageData })
                });
                const text = await response.text();
                let result;
                try { result = JSON.parse(text); } catch (e) { result = text; }
                document.getElementById('aws_result').innerHTML = '<pre>' + JSON.stringify(result, null, 2) + '</pre>';
            } catch (err) {
                document.getElementById('aws_result').innerHTML = '<div class="result error">ì„œë²„ ì˜¤ë¥˜: ' + err.message + '</div>';
            }
        }
        // AWS Rekognition ì–¼êµ´ ì¸ì¦ (POST)
        async function awsAuthFace() {
            const token = document.getElementById('aws_token').value;
            const ticketId = document.getElementById('aws_ticket_id').value;
            if (!token || !ticketId) {
                document.getElementById('aws_result').innerHTML = '<div class="result error">í† í°ê³¼ í‹°ì¼“IDë¥¼ ì…ë ¥í•˜ì„¸ìš”.</div>';
                return;
            }
            // ê°€ì´ë“œë¼ì¸ ì²´í¬
            if (!(await checkFaceInEllipse())) {
                document.getElementById('aws_result').innerHTML = '<div class="result error">ì–¼êµ´ì„ ê°€ì´ë“œë¼ì¸ ì•ˆì— ë§ì¶°ì£¼ì„¸ìš”.</div>';
                return;
            }
            // ì¹´ë©”ë¼ ìº¡ì²˜
            const video = document.getElementById('video');
            const canvas = document.getElementById('canvas');
            const context = canvas.getContext('2d');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            context.drawImage(video, 0, 0);
            const imageData = canvas.toDataURL('image/jpeg').split(',')[1];
            try {
                const response = await fetch(`/api/v1/tickets/${ticketId}/aws-auth/`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + token
                    },
                    body: JSON.stringify({ image: imageData })
                });
                const text = await response.text();
                let result;
                try { result = JSON.parse(text); } catch (e) { result = text; }
                document.getElementById('aws_result').innerHTML = '<pre>' + JSON.stringify(result, null, 2) + '</pre>';
            } catch (err) {
                document.getElementById('aws_result').innerHTML = '<div class="result error">ì„œë²„ ì˜¤ë¥˜: ' + err.message + '</div>';
            }
        }
        // AWS Rekognition ì–¼êµ´ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
        async function loadAwsFaceList() {
            const token = document.getElementById('aws_list_token').value;
            if (!token) {
                document.getElementById('aws_list_result').innerHTML = '<div class="result error">í† í°ì„ ì…ë ¥í•˜ì„¸ìš”.</div>';
                return;
            }
            try {
                const response = await fetch('/api/v1/tickets/face-list/', {
                    method: 'GET',
                    headers: {
                        'Authorization': 'Bearer ' + token
                    }
                });
                const result = await response.json();
                if (response.ok && result.data) {
                    renderAwsFaceList(result.data, token);
                    document.getElementById('aws_list_result').innerHTML = '<div class="result success">ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° ì„±ê³µ</div>';
                } else {
                    document.getElementById('aws_list_result').innerHTML = '<pre>' + JSON.stringify(result, null, 2) + '</pre>';
                    document.getElementById('aws_face_list').innerHTML = '';
                }
            } catch (err) {
                document.getElementById('aws_list_result').innerHTML = '<div class="result error">ì„œë²„ ì˜¤ë¥˜: ' + err.message + '</div>';
                document.getElementById('aws_face_list').innerHTML = '';
            }
        }
        function renderAwsFaceList(data, token) {
            const listEl = document.getElementById('aws_face_list');
            listEl.innerHTML = '';
            if (!data || data.length === 0) {
                listEl.innerHTML = '<li>ë“±ë¡ëœ ì–¼êµ´ì´ ì—†ìŠµë‹ˆë‹¤.</li>';
                return;
            }
            data.forEach(face => {
                const li = document.createElement('li');
                li.innerHTML = `${face.ExternalImageId} <span style='color:#888'>(FaceId: ${face.FaceId})</span> <button class='btn' style='padding:4px 10px;font-size:12px;' onclick="deleteAwsFace('${face.FaceId}')">ì‚­ì œ</button>`;
                listEl.appendChild(li);
            });
        }
        // AWS Rekognition ì–¼êµ´ ì‚­ì œ
        async function deleteAwsFace(faceId) {
            const token = document.getElementById('aws_list_token').value;
            if (!faceId) {
                document.getElementById('aws_list_result').innerHTML = '<div class="result error">face_idê°€ í•„ìš”í•©ë‹ˆë‹¤.</div>';
                return;
            }
            if (!token) {
                document.getElementById('aws_list_result').innerHTML = '<div class="result error">í† í°ì„ ì…ë ¥í•˜ì„¸ìš”.</div>';
                return;
            }
            if (!confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            try {
                const response = await fetch('/api/v1/tickets/face-delete/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + token
                    },
                    body: JSON.stringify({ face_id: faceId })
                });
                const result = await response.json();
                if (response.ok) {
                    document.getElementById('aws_list_result').innerHTML = '<div class="result success">ì‚­ì œ ì„±ê³µ</div>';
                    loadAwsFaceList();
                } else {
                    document.getElementById('aws_list_result').innerHTML = '<pre>' + JSON.stringify(result, null, 2) + '</pre>';
                }
            } catch (err) {
                document.getElementById('aws_list_result').innerHTML = '<div class="result error">ì„œë²„ ì˜¤ë¥˜: ' + err.message + '</div>';
            }
        }
        // ê²°ê³¼ ë©”ì‹œì§€ ì¶œë ¥ í•¨ìˆ˜
        function showResult(message, type) {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = `<div class="result ${type}">${message}</div>`;
        }

        // ë¡œê·¸ì¸
        async function login() {
            const email = document.getElementById('login_email').value;
            const password = document.getElementById('login_password').value;
            if (!email || !password) {
                showLoginResult('ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”.', 'error');
                return;
            }
            try {
                const response = await fetch('/api/v1/user/login/', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });
                const result = await response.json();
                if (response.ok) {
                    let token = result.token || result.access || result.key || '';
                    showLoginResult('ë¡œê·¸ì¸ ì„±ê³µ!<br><pre>' + JSON.stringify(result, null, 2) + '</pre>', 'success');
                    if (token) {
                        // í† í° ì…ë ¥ë€ì— ìë™ ì…ë ¥
                        document.getElementById('db_token').value = token;
                        document.getElementById('aws_token').value = token;
                        document.getElementById('aws_list_token').value = token;
                        document.getElementById('token_box').style.display = '';
                        document.getElementById('token_box').innerHTML = 'Access Token:<br>' + token + '<br><button onclick="copyToken()" class="btn" style="margin-top:6px;">ë³µì‚¬</button>';
                    }
                } else {
                    showLoginResult('ë¡œê·¸ì¸ ì‹¤íŒ¨: ' + (result.message || JSON.stringify(result)), 'error');
                }
            } catch (err) {
                showLoginResult('ì„œë²„ ì˜¤ë¥˜: ' + err.message, 'error');
            }
        }
        function showLoginResult(message, type) {
            const resultDiv = document.getElementById('login_result');
            resultDiv.innerHTML = `<div class="result ${type}">${message}</div>`;
        }
        function copyToken() {
            const token = document.getElementById('db_token').value;
            if (token) {
                navigator.clipboard.writeText(token);
                alert('í† í°ì´ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
            }
        }
    </script>
    <!-- 1. face-api.js CDN -->
    <script defer src="https://cdn.jsdelivr.net/npm/face-api.js@0.22.2/dist/face-api.min.js"></script>

    <!-- 2. ë‚´ JS ì½”ë“œ (defer í•„ìˆ˜) -->
    <script defer>
    let faceInEllipse = false;

    // ì–¼êµ´ ê°€ì´ë“œë¼ì¸ ì²´í¬ í•¨ìˆ˜ (face-api.js í•„ìš”)
    async function checkFaceInEllipse() {
        const video = document.getElementById('video');
        if (!video || video.readyState !== 4) {
            return false;
        }
        if (!window.faceapi) return false;
        const detections = await faceapi.detectSingleFace(video, new faceapi.TinyFaceDetectorOptions());
        if (!detections) return false;
        const box = detections.box;
        const faceCenterX = box.x + box.width / 2;
        const faceCenterY = box.y + box.height / 2;
        const videoW = video.videoWidth;
        const videoH = video.videoHeight;
        const ellipseCX = videoW / 2;
        const ellipseCY = videoH / 2;
        // ì‹¤ì œ ì¸ì‹ íƒ€ì› (ê°€ì´ë“œë¼ì¸ë³´ë‹¤ ë” ì‘ê²Œ)
        const rx = videoW * 0.12;
        const ry = videoH * 0.20;
        const normX = (faceCenterX - ellipseCX) / rx;
        const normY = (faceCenterY - ellipseCY) / ry;
        return (normX * normX + normY * normY) <= 1;
    }

    // [ëª¨ë¸ ë¡œë“œ ë° ì£¼ê¸°ì  ì–¼êµ´ ìœ„ì¹˜ ì²´í¬] í˜ì´ì§€ ë¡œë“œ ì‹œ ëª¨ë¸ ë¡œë“œ, 0.7ì´ˆë§ˆë‹¤ ì²´í¬
    window.addEventListener('DOMContentLoaded', async function() {
        await faceapi.nets.tinyFaceDetector.loadFromUri('https://justadudewhohacks.github.io/face-api.js/models');
        setInterval(checkFaceInEllipse, 700);
    });

    // ë°˜ë“œì‹œ ì‹¤ì œ ì½”ë“œë¡œ í•¨ìˆ˜ ì„ ì–¸!
    async function registerFaceToServerWithUserAndTicket(imageData, ticketId, token) {
        try {
            const response = await fetch(`/api/v1/tickets/${ticketId}/register/`, {
                method: 'PATCH',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'Bearer ' + token
                },
                body: JSON.stringify({
                    face_verified: true,
                    image: imageData // â† base64 ì´ë¯¸ì§€ë„ ê°™ì´ ë³´ëƒ„
                })
            });
            const result = await response.json();
            if (response.ok) {
                showResult('<pre>' + JSON.stringify(result, null, 2) + '</pre>', 'success');
            } else {
                showResult('<pre>' + JSON.stringify(result, null, 2) + '</pre>', 'error');
            }
        } catch (err) {
            showResult('ì„œë²„ ì˜¤ë¥˜: ' + err.message, 'error');
        }
    }

    async function verifyFace(ticketId, token) {
        if (!ticketId) {
            showResult('ì¸ì¦í•  í‹°ì¼“ IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
            return;
        }
        try {
            const response = await fetch(`/api/v1/tickets/${ticketId}/verify/`, {
                method: 'PATCH',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'Bearer ' + token
                },
                body: JSON.stringify({ face_matches: 99 }) // ì˜ˆì‹œ
            });
            const result = await response.json();
            if (response.ok) {
                showResult('<pre>' + JSON.stringify(result, null, 2) + '</pre>', 'success');
            } else {
                showResult('<pre>' + JSON.stringify(result, null, 2) + '</pre>', 'error');
            }
        } catch (err) {
            showResult('ì„œë²„ ì˜¤ë¥˜: ' + err.message, 'error');
        }
    }

    async function getFaceAuthStatus(ticketId, token) {
        try {
            const response = await fetch(`/api/v1/tickets/${ticketId}/auth/`, {
                method: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + token
                }
            });
            const result = await response.json();
            if (response.ok) {
                showResult('<pre>' + JSON.stringify(result, null, 2) + '</pre>', 'success');
            } else {
                showResult('<pre>' + JSON.stringify(result, null, 2) + '</pre>', 'error');
            }
        } catch (err) {
            showResult('ì„œë²„ ì˜¤ë¥˜: ' + err.message, 'error');
        }
    }
    </script>
</body>
</html>
